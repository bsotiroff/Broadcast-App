<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font: 13px Helvetica, Arial;
      }
      .speaker-button {
        height: 300px;
        width: 300px;
        display: block;
        margin: 60px auto;
        overflow: hidden;
        position: relative;
      }
    </style>
  </head>
  <body>
    <div>Hello World</div>
    <iframe
      width="560"
      height="315"
      src="https://www.youtube.com/embed/lrX6ktLg8WQ"
      frameborder="0"
      allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
    ></iframe>
    <button class="speaker-button" onclick="record()">Record</button>
    <!-- <button class="stop-button" onclick="endRecording()">Stop</button> -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      socket.on('connect', function() {
        socket.send('connected');
      });

      function record() {
        socket.send('message');
        navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
          const mediaRecorder = new MediaRecorder(stream);
          let audioChunks = [];
          //when button is pushed, record and emit audio
          mediaRecorder.start();

          mediaRecorder.addEventListener('dataavailable', event => {
            audioChunks.push(event.data);
            socket.emit('audioMessage', audioChunks);
          });
        });

        // socket.emit('text', msg);
        console.log('record');
      }

      // function endRecording() {
      //   mediaRecorder.stop();
      //   // mediaRecorder.addEventListener('stop', () => {
      //   //   audioChunks = [];
      //   // });
      // }
    </script>
  </body>
</html>

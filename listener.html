<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font: 13px Helvetica, Arial;
      }
      .speaker-button {
        height: 300px;
        width: 300px;
        display: block;
        margin: 60px auto;
        overflow: hidden;
        position: relative;
      }
    </style>
  </head>
  <body>
    <div>Hello World</div>
    <iframe
      width="560"
      height="315"
      src="https://www.youtube.com/embed/lrX6ktLg8WQ"
      frameborder="0"
      allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
    ></iframe>
    <button class="playStream">Play Stream</button>
    <script src="/socket.io/socket.io.js"></script>

    <script>
      const socket = io();

      socket.on('connect', function() {
        console.log('socket connected');
        socket.send('connected');
      });
      // let audioChunks = [];

      let playStream = document.getElementsByClassName('playStream')[0];

      // 1. converted array buffer to blob,
      // 2. added if statement with then
      // 3. originally only first blob played anything else returned an erro
      // 4. added rec.stop(), rec.start(300), now all are plying
      // 5. issue: feedback gets recorded

      socket.on('listenToMessage', function(msg) {
        console.log('Before we make it a blob: ', msg);
        var blob = new Blob([msg], { type: 'audio/ogg; codecs=opus' });
        var audio = document.createElement('audio');
        audio.src = window.URL.createObjectURL(blob);
        var playPromise = audio.play();
        // console.log('playPromise: ', playPromise)
        if (playPromise !== undefined) {
          playPromise
            .then(_ => {
              console.log('playback');
              rec.stop();
              rec.start(300);
            })
            .catch(error => {
              console.log('error: ', error);
            });
        }
      });

      // socket.emit("listenToMessage", msg);

      playStream.onclick = () => {};

      function playMessage() {
        //  while (bool) {
        //    console.log('Play stream: ', message)
        //  }
      }
    </script>
  </body>
</html>
